# `ntransporter/cross_sections/`

Directory for all things involving reading in cross section 
data from Geant4, storing and plotting cross section data, 
and calculating group constants

## Executables

This directory generates two executables for group cross section evaluation

### `NT_XS`

`NT_XS` is the primary executable generated by the `cross_sections` directory. It calculates group cross sections for a single combination of material, number of fast groups, and number of points in numerical evaluation. The call signature is:

```
./NT_XS output_file_base_path material [ngroups=100] [points_per_group=10]
```

**Outputs:**

The executable creates one output data file, with the form 

```
<output_file_base_path>_<material>_<ngroups>_<points_per_group>_xs.dat
```

**Arguments:**

`output_file_base_path` : base of file path of output data files, including base of filename

`material` : name of `G4Material` to calculate cross sections for (must be a named material in `CDMSMaterialTable` in `SuperSim`)

`ngroups` : (optional, default = 100) number of fast groups

`points_per_group` : (optional, default = 10) number of trapezoidal regions to approximate integrals with - note this can only be set if `ngroups` is set




**Example:**

From inside build directory `ntransporter/build`, run

```
./NT_XS ../cross_sections/data/V1/cross_sections G4_Si 100 20
```

The resulting output file will then have the form 

```
<...>/ntransporter/cross_sections/data/V1/cross_sections_G4_Si_50_20_xs.dat
```



### `NT_XX`

`NT_XX` is an expanded version of `NT_XS` that performs calculations for multiple material/group number combinations within a single `SuperSim` instance. 

> [!CAUTION]
> The results of cross section calculations in `Geant4` depend on the order in which values are calculated, meaning that if multiple material/grouping calculations are performed in the same instance of `SuperSim`, as is done by `NT_XX`, the results will change depending on the order of arguments. See [Issue #2](https://github.com/villano-lab/ntransporter/issues/2)

Call signature:

```
./NT_XX output_file_base_path material1 material2 ... [-n ngroups1=100 ngroups2 ...]
```

**Outputs:**

The executable creates output data files for each combination of material/ngroups, i.e., 

```
<output_file_base_path>_<material1>_<ngroups1>_20_xs.dat
<output_file_base_path>_<material1>_<ngroups2>_20_xs.dat
.
.
.
<output_file_base_path>_<material2>_<ngroups1>_20_xs.dat
<output_file_base_path>_<material2>_<ngroups2>_20_xs.dat
.
.
.
```

**Arguments:**

`output_file_base_path` : base of file path of output data files, including base of filename

`material<n>` : names of `G4Material` to calculate cross sections for (must be a named material in `CDMSMaterialTable` in `SuperSim`)

`ngroups<n>` : (optional, default = 100) number of fast groups - note `-n` must be added after the list of materials and before the first of the `ngroup`'s



## Subdirectories

The directory substructure under `cross_sections` is the following:

```
|- ntransporter/
|---- cross_sections/
|------- data/
|---------- V1/
|               output data from NT_XS v1.0
|------- examples/
|---------- reading_writing/
|               self-contained example program 
|               to read and print Geant4 cross 
|               section data
```

## Group Cross Section Evaluation

Version 1 of `ntransporter` uses a zeroth-order approximation for the flux in the expressions for the group cross sections:

$\Sigma_{ig} = \frac{1}{\phi_g} \int_g dE \Sigma_i(E) \phi(E)$


$\phi_g = \int_g dE \phi(E)$

where we approximate $\phi(E)$ as a $1/E$ distribution. The group cross sections turn into:


$\Sigma_{ig} = \left(\int_g dE \Sigma_i(E)/E \right)/\left(\int_g dE/E\right)$

We then approximate the integrals as trapezoidal integrals over $n_g$ trapezoids:

$\Sigma_{ig} = \left(\sum_{k=1}^{n_g}\Sigma_i(E_k)/E_k + \Sigma_i(E_{k-1})/E_{k-1}\right)/\left(\sum_{k=1}^{n_g}1/E_k+1/E_{k-1}\right)$

where the $E_k$ are logarithmically spaced between $E_g$ and $E_{g-1}$: $E_k = E_gr^k$, $r=(E_{g-1}/E_g)^{1/n_g}$
 



